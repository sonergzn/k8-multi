version: 2.1
# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/2.0/configuration-reference/#jobs
jobs:
  BeforeInstallAndRunTests:
    machine: #Runner Type, it can be docker, machine ...
      image: ubuntu-2004:202010-01
      docker_layer_caching: true #Gives the docker environment too (It caches the image layers).
    resource_class: medium
    steps:
      - checkout
      - run:
          name: Docker Login and build client for tests
          command: | 
            echo ${DOCKER_PASSWORD} | docker login -u ${DOCKER_USERNAME} --password-stdin
            docker build -t sonergezgen/client -f ./client/Dockerfile.dev ./client
      - run:
          name: Run Tests
          command: |
            docker run sonergezgen/client timeout 30 npm test -- --coverage --exit
# Invoke jobs via workflows
# See: https://circleci.com/docs/2.0/configuration-reference/#workflows
workflows:
  before_install_job:
    jobs:
      - BeforeInstallAndRunTests
